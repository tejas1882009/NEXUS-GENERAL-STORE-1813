<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel - Nexus General Store</title>
  <style>
    body { margin: 0; font-family: 'Segoe UI', sans-serif;
      background: url('https://images.unsplash.com/photo-1522199710521-72d69614c702?auto=format&fit=crop&w=1920&q=80') no-repeat center center fixed;
      background-size: cover; color: #fff; }
    .overlay { background-color: rgba(0,0,0,0.8); padding: 30px; min-height: 100vh; text-align: center; }
    h1,h2 { color: #00cec9; }
    input, button { padding: 10px; width: 90%; max-width: 400px; margin: 10px auto; border-radius: 5px; display: block; border: none; }
    button { background: #00cec9; color: white; cursor: pointer; }
    .product-entry { background: #ffffffdd; color: #000; margin: 15px auto; padding: 15px; border-radius: 10px; width: 90%; max-width: 600px; text-align: left; }
    .product-entry input { width: 100%; margin: 5px 0; }
    .actions { text-align: right; }
    .delete { background: #d63031; margin-left: 5px; }
    #loginBox { position: fixed; top:0; left:0; width:100%; height:100vh; background: rgba(0,0,0,0.9); display:flex; flex-direction:column; align-items:center; justify-content:center; }
  </style>
</head>
<body>
  <div id="loginBox">
    <h2>Enter Admin Password</h2>
    <input type="password" id="adminPass" placeholder="Password">
    <button onclick="checkPassword()">Login</button>
  </div>
  <div class="overlay" id="adminPanel" style="display:none;">
    <h1>Admin Panel - Nexus General Store</h1>
    <input id="pname" placeholder="Name">
    <input id="pimage" placeholder="Image URL">
    <input id="pdesc" placeholder="Description">
    <input id="pprice" placeholder="Price (â‚¹)">
    <input id="plink" placeholder="Affiliate Link">
    <button onclick="addProduct()">Add Product</button>
    <h2>Products</h2>
    <div id="productList"></div>
  </div>
  <script>
    const adminPass = 'nexus@123';
    let products = [];

    function checkPassword() {
      if (document.getElementById('adminPass').value === adminPass) {
        document.getElementById('loginBox').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        fetch('/products').then(r => r.json()).then(d => { products = d.products; render(); });
      } else alert('Wrong password');
    }

    function render() {
      const el = document.getElementById('productList');
      el.innerHTML = '';
      products.forEach((p,i) => {
        const div = document.createElement('div'); div.className = 'product-entry';
        div.innerHTML = `
          <input value="${p.name}" onchange="editField(${i}, 'name', this.value)">
          <input value="${p.image}" onchange="editField(${i}, 'image', this.value)">
          <input value="${p.desc}" onchange="editField(${i}, 'desc', this.value)">
          <input value="${p.price}" onchange="editField(${i}, 'price', this.value)">
          <input value="${p.link}" onchange="editField(${i}, 'link', this.value)">
          <div class="actions">
            <button onclick="deleteProduct(${i})" class="delete">Delete</button>
          </div>`;
        el.appendChild(div);
      });
    }

    async function addProduct() {
      const p = {
        name:document.getElementById('pname').value.trim(),
        image:document.getElementById('pimage').value.trim(),
        desc:document.getElementById('pdesc').value.trim(),
        price:document.getElementById('pprice').value.trim(),
        link:document.getElementById('plink').value.trim()
      };
      if(Object.values(p).some(v=>!v)) return alert('Fill all fields');
      const res = await fetch('/products', {method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(p)});
      products = (await res.json()).products; render();
    }

    async function editField(i, field, val) {
      products[i][field] = val;
      await fetch(`/products/${i}`,{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(products[i])});
    }

    async function deleteProduct(i) {
      await fetch(`/products/${i}`,{method:'DELETE'});
      products.splice(i,1);
      render();
    }
  </script>
</body>
</html>
